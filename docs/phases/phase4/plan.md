# Phase 4 詳細計画

**フェーズ目標**: ゲーム結果をサマリー形式で確認できるようにする

**成果物**:
- 結果サマリーレポート生成機能
- プレイヤー別の最終状態詳細表示
- Phase 2の詳細進行表示とは別の、結果確認用HTMLファイル

**重要方針**:
- **Phase 2のHTMLレポートとの差別化**
  - Phase 2: 詳細なゲーム進行レポート（イベントタイムライン中心）
  - Phase 4: 結果に特化したサマリーレポート（統計情報、最終結果中心）
- 既存のHtmlReportGeneratorは維持し、新しいSummaryReportGeneratorを追加
- 2つのHTMLファイルを生成：詳細レポートとサマリーレポート

---

## ⚠️ この計画書の位置づけ

**このドキュメントに書かれているタスク分解や実装内容は「出発点」であり、「確定仕様」ではありません。**

### TDDでの柔軟な計画変更

このドキュメントには詳細なタスク分解と具体的な実装内容が記載されていますが、これらは：

- ✅ **実装の出発点**として活用する
- ✅ **実装中に不要と判断したタスクはスキップする**
- ✅ **新たに必要なタスクが見つかれば追加する**
- ✅ **実装順序も柔軟に変更する**
- ❌ **この通りに実装しなければならない**わけではない

**TDDのテストを書きながら、最適なタスク分解と実装順序を見つける。**

---

## L1: Phase 4全体概要

Phase 4では、ゲーム結果を一目で確認できるサマリーレポートを実装します。Phase 2で実装した詳細な進行レポートとは異なり、結果の要約と最終状態に焦点を当てます。

### Phase 2のレポートとの違い

| 観点 | Phase 2（詳細レポート） | Phase 4（サマリーレポート） |
|------|----------------------|-------------------------|
| 目的 | ゲーム進行の追跡 | 結果の確認 |
| 主要コンテンツ | イベントタイムライン | 統計サマリー |
| 情報量 | 詳細（全イベント） | 要約（重要指標のみ） |
| ファイル名 | game-report-*.html | game-summary-*.html |
| 使用場面 | デバッグ、詳細分析 | 結果の素早い確認 |

### Phase 1, 2, 3のコードへの影響

Phase 4では新しいレポート生成機能を追加します：

1. **新規クラスの追加**
   - SummaryReportGeneratorクラスを作成
   - 既存のHtmlReportGeneratorは維持

2. **Main.ktの変更**
   - 2つのHTMLファイルを生成するように変更
   - 詳細レポートとサマリーレポートの両方を出力

3. **既存コードへの影響**
   - HtmlReportGeneratorは変更なし
   - その他のコードも変更なし

---

## L2: 機能分類

### L2-1: 結果サマリーレポート生成
ゲーム結果を要約したHTMLレポートを生成

### L2-2: プレイヤー詳細情報表示
各プレイヤーの最終資産と所有プロパティの詳細を表示

### L2-3: 統計情報の集計
ゲーム全体の統計情報を計算・表示

---

## L3: 詳細タスク

### L2-1: 結果サマリーレポート生成

#### L3-1-1: SummaryReportGenerator実装
- **タスク**: SummaryReportGeneratorクラスを作成
- **内容**:
  - generate(gameState)メソッドでHTML文字列を生成
  - saveToFile(gameState, filename)メソッドでファイル保存
  - シンプルで見やすいデザイン（Phase 2よりコンパクト）
- **成果物**: `SummaryReportGenerator.kt`
- **Phase 1, 2, 3への影響**: なし（新規追加）
- **テスト**: 手動テスト（HTMLをブラウザで確認）

#### L3-1-2: 勝者情報セクション
- **タスク**: 勝者の情報を目立つように表示
- **内容**:
  - 勝者名
  - 最終資産額
  - 所有プロパティ数
  - プレイヤーアイコン（絵文字）
- **成果物**: SummaryReportGenerator内のメソッド
- **Phase 1, 2, 3への影響**: なし
- **テスト**: 手動テスト

#### L3-1-3: ゲーム統計セクション
- **タスク**: ゲーム全体の統計を表示
- **内容**:
  - 総ターン数
  - ゲーム時間（計算ではなく、概念として）
  - 破産したプレイヤー数
  - 購入されたプロパティ数
  - 支払われた総レント額
- **成果物**: SummaryReportGenerator内のメソッド
- **Phase 1, 2, 3への影響**: なし
- **テスト**: 手動テスト

---

### L2-2: プレイヤー詳細情報表示

#### L3-2-1: プレイヤーランキング表示
- **タスク**: プレイヤーを最終資産順に表示
- **内容**:
  - 順位（1位、2位、...）
  - プレイヤー名
  - 最終資産額
  - 現金
  - 所有プロパティ数
  - ステータス（ACTIVE/BANKRUPT）
- **成果物**: SummaryReportGenerator内のメソッド
- **Phase 1, 2, 3への影響**: なし
- **テスト**: 手動テスト

#### L3-2-2: 所有プロパティ詳細
- **タスク**: 各プレイヤーの所有プロパティ一覧を表示
- **内容**:
  - プロパティ名
  - 価格
  - レント
  - カラーグループ
- **成果物**: SummaryReportGenerator内のメソッド
- **Phase 1, 2, 3への影響**: なし
- **テスト**: 手動テスト

---

### L2-3: 統計情報の集計

#### L3-3-1: イベント統計の計算
- **タスク**: イベントログから統計を計算
- **内容**:
  - 購入されたプロパティ総数
  - 支払われた総レント額
  - プレイヤー別の購入数
  - プレイヤー別のレント支払額
- **成果物**: SummaryReportGenerator内のメソッド
- **Phase 1, 2, 3への影響**: なし
- **テスト**: イベントログから正しく集計されること

---

## タスクの優先順位

### 必須タスク（Phase 4 完了に必要）
1. L3-1-1: SummaryReportGenerator実装
2. L3-1-2: 勝者情報セクション
3. L3-1-3: ゲーム統計セクション
4. L3-2-1: プレイヤーランキング表示
5. L3-2-2: 所有プロパティ詳細

### オプションタスク
- L3-3-1: イベント統計の計算（Phase 6で本格実装予定）

### 推奨実装順序

1. **SummaryReportGenerator実装** (L3-1-1) - 基本構造を作成
2. **勝者情報セクション** (L3-1-2) - 最も重要な情報
3. **プレイヤーランキング表示** (L3-2-1) - 全プレイヤーの結果
4. **所有プロパティ詳細** (L3-2-2) - 各プレイヤーの詳細
5. **ゲーム統計セクション** (L3-1-3) - 全体サマリー
6. **Main.kt更新** - 2つのレポートを生成

---

## 見積もり

| タスク分類 | 想定時間 |
|-----------|---------|
| L2-1: 結果サマリーレポート生成 | 2-3時間 |
| L2-2: プレイヤー詳細情報表示 | 1-2時間 |
| L2-3: 統計情報の集計 | 1-2時間 |
| **合計** | **4-7時間（0.5-1日）** |

---

## Phase 4完了条件

- [ ] SummaryReportGeneratorが実装されている
- [ ] 勝者情報が目立つように表示される
- [ ] プレイヤーランキングが資産順に表示される
- [ ] 各プレイヤーの所有プロパティが一覧表示される
- [ ] ゲーム統計（総ターン数など）が表示される
- [ ] game-summary-*.htmlファイルが生成される
- [ ] Phase 2の詳細レポートも維持されている
- [ ] ブラウザで開いて結果が一目で分かる（手動テスト）

---

## 生成されるファイル

Phase 4完了後、ゲーム実行時に以下の2つのHTMLファイルが生成されます：

1. **game-report-{timestamp}.html** (Phase 2)
   - 詳細なゲーム進行レポート
   - イベントタイムライン
   - ターンごとの状態

2. **game-summary-{timestamp}.html** (Phase 4)
   - 結果サマリーレポート
   - 勝者情報
   - プレイヤーランキング
   - 統計情報

---

## 次のアクション

1. **Phase 4設計レビュー**
   - このドキュメントをレビュー
   - サマリーレポートの設計を確認

2. **Phase 4実装開始**
   - SummaryReportGeneratorから実装
   - シンプルで見やすいデザインを重視

---

**作成日**: 2025-11-16
**最終更新**: 2025-11-16
