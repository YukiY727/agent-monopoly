# 未実装モノポリールール

**作成日**: 2025-11-22

このドキュメントでは、モノポリーの標準ルールのうち、現在未実装の機能をリストアップし、実装の優先順位とフェーズ分けを定義します。

---

## 実装状況サマリー

### ✅ 実装済み機能
1. ゲームの基本進行（ターン、移動、家賃支払い）
2. GO通過ボーナス（$200）
3. 破産処理とゲーム終了判定
4. プロパティ購入判定（戦略パターンに基づく）
5. イベントログ記録システム（Phase 2）

### ❌ 未実装の主要機能

#### 優先度: 高（ゲーム性に大きく影響）
1. **建物システム** - 家、ホテル、建設ルール
2. **ダブル（ゾロ目）** - ゾロ目判定、追加ターン、3回連続ゾロ目
3. **刑務所機能** - 収監状態管理、脱出方法
4. **カード機能** - チャンスカード、共同基金カード
5. **税金マス** - 所得税、物品税の処理
6. **鉄道・公共施設** - 特殊な家賃計算ルール

#### 優先度: 中（戦略の幅が広がる）
7. **抵当機能** - Mortgage、利息計算
8. **オークション** - 入札システム、複数プレイヤー同時入札

#### 優先度: 低（研究目的では後回し可）
9. **交渉・取引** - プレイヤー間の物件・現金取引

---

## フェーズ分け提案

### Phase 3: 建物システムとダブル
**目標**: 建物建設とゾロ目ルールを実装し、ゲームの戦略性を向上

#### 実装内容
1. **建物システム**
   - 家（最大4件）とホテル（1件）の概念
   - 同色プロパティ全所有（モノポリー）の判定
   - 建物の均等建設ルール
   - 家賃計算の拡張（建物数に応じた変動）

2. **ダブル（ゾロ目）**
   - Diceクラスの拡張（個別のサイコロ値を返す）
   - ゾロ目判定ロジック
   - 追加ターン実行
   - 3回連続ゾロ目で刑務所送り

#### 期待される効果
- 戦略の多様性が増す（建設 vs 資金温存）
- ゲーム展開が加速（ゾロ目による追加ターン）
- よりリアルなモノポリー体験

---

### Phase 4: 刑務所とカードシステム
**目標**: 刑務所の収監状態とカード機能を実装し、ゲームのランダム性を追加

#### 実装内容
1. **刑務所機能**
   - PlayerStateに刑務所状態を追加（収監 vs 訪問）
   - 収監ターン数の追跡
   - 脱出方法の実装:
     - $50支払い
     - ゾロ目を出す（最大3回試行）
     - 脱出カード使用
     - 3ターン経過後の強制脱出
   - 刑務所行きマスの処理

2. **カード機能（チャンス・共同基金）**
   - Cardクラスの設計（sealed class）
   - カードデッキの管理
   - カード効果の実装:
     - 移動系（指定マスへ移動、N歩前進/後退）
     - 金銭系（受取/支払い）
     - 特殊系（刑務所行き、脱出カード）
     - 建物課金系（家・ホテルごとの支払い/受取）
   - カードの山札管理（使用後は底へ、脱出カードは保持）

#### 期待される効果
- ゲームのランダム性が増加
- 戦略の幅が広がる（刑務所での待機戦略など）
- カードによる逆転要素

---

### Phase 5: 税金と特殊プロパティ
**目標**: 税金マスと鉄道・公共施設の特殊な家賃計算を実装

#### 実装内容
1. **税金マス**
   - 所得税マス: $200支払い
   - 物品税マス: $100支払い
   - 税金支払い不能時の破産処理

2. **鉄道の家賃計算**
   - 所有数に応じた家賃（1件: $25, 2件: $50, 3件: $100, 4件: $200）
   - 同一プレイヤーの鉄道所有数カウント

3. **公共施設の家賃計算**
   - サイコロの目 × 所有数倍率（1件: 4倍, 2件: 10倍）
   - 停止時のサイコロ値の再利用

#### 期待される効果
- より正確なモノポリールールの再現
- 鉄道・公共施設の戦略的価値が明確に

---

### Phase 6: 抵当システム
**目標**: 抵当機能を実装し、資金調達の選択肢を増やす

#### 実装内容
1. **抵当設定**
   - PropertyOwnershipに抵当状態を追加
   - 抵当に入れる処理（物件価格の50%獲得）
   - 抵当中は家賃収入なし
   - 建物がある場合は先に売却が必要

2. **抵当解除**
   - 借入額の110%を支払う（10%利息）
   - 所有権の復活

3. **破産処理との統合**
   - 抵当物件の譲渡処理
   - 銀行破産時のオークション処理

#### 期待される効果
- 破産回避の戦略が増える
- 資金繰りの重要性が増す

---

### Phase 7: オークションシステム
**目標**: 購入拒否時のオークションを実装

#### 実装内容
1. **オークション機構**
   - Auctionクラスの設計
   - 入札管理（最低$1、所持金上限）
   - パス管理（再参加不可）
   - 落札判定

2. **購入拒否時の処理**
   - processUnownedPropertyの拡張
   - 全プレイヤーの入札戦略

3. **破産時のオークション**
   - 銀行破産時の全資産オークション

#### 期待される効果
- より戦略的な購入判断（高すぎる物件は拒否してオークション狙い）
- プレイヤー間の駆け引き

---

### Phase 8以降: 交渉・取引（優先度低）
**目標**: プレイヤー間の取引機能を実装

#### 実装内容
1. **取引システム**
   - 2者間取引のみ
   - 取引可能アイテム: プロパティ、現金、脱出カード
   - 即時決済（将来の約束は無効）
   - 建物付き物件の取引制限

#### 実装を後回しにする理由
- AIプレイヤー間の交渉戦略は非常に複雑
- 研究の初期段階では不要
- Phase 3-7の機能だけで十分なゲーム性が確保できる

---

## 次のアクション

1. **Phase 2を完了させる**
   - EventLogger（JSON保存/読み込み）
   - HtmlReportGenerator（HTMLレポート生成）
   - Main.ktの統合

2. **Phase 3の詳細設計を開始**
   - 建物システムの設計書作成
   - ゾロ目ルールの設計書作成
   - テストケースリストの作成

3. **CLI視覚化は適切なタイミングで実装**
   - Phase 3以降、建物が実装されてから視覚化を実装する方が効率的

---

## 設計上の考慮事項

### トレードオフ

#### 1. 建物システム vs 抵当システム
- **優先**: 建物システム（Phase 3）
- **理由**: ゲーム性への影響が大きい、戦略の多様性が増す
- **抵当**: Phase 6まで延期（破産回避の手段として重要だが、建物ほど戦略的ではない）

#### 2. カードシステムの実装タイミング
- **Phase 4で実装**
- **理由**: ランダム性の追加、ゲーム展開の多様化
- **トレードオフ**: 実装の複雑さ vs ゲーム性の向上 → ゲーム性を優先

#### 3. オークションの実装タイミング
- **Phase 7まで延期**
- **理由**: 基本的なゲームロジックが完成してから
- **トレードオフ**: 完全性 vs 開発速度 → 段階的な実装を優先

### YAGNI原則との整合性

- **Phase 3-5**: ゲームの基本ルールとして必須
- **Phase 6-7**: ゲームの戦略性を高めるため実装
- **Phase 8以降**: 必要性が判明してから実装（YAGNI）

---

**次回更新**: Phase 3開始時に詳細設計を追加
