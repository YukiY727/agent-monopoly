#!/bin/bash

# ãƒ¢ãƒãƒãƒªãƒ¼ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ pre-commit hook
# ãƒ­ãƒ¼ã‚«ãƒ«CIã¨ã—ã¦ã€ã‚³ãƒŸãƒƒãƒˆå‰ã«ã‚³ãƒ¼ãƒ‰å“è³ªãƒã‚§ãƒƒã‚¯ã‚’å®Ÿè¡Œ

set -e

echo "ğŸ” Running pre-commit checks..."

# Gradleã‚³ãƒãƒ³ãƒ‰ã‚’æ¤œå‡º
if [ -f "./gradlew" ]; then
    GRADLE_CMD="./gradlew"
elif command -v gradle &> /dev/null; then
    GRADLE_CMD="gradle"
else
    echo "âŒ Gradle not found!"
    exit 1
fi

# 1. ktlint (ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆãƒã‚§ãƒƒã‚¯)
echo "ğŸ“ Checking code format (ktlint)..."
$GRADLE_CMD ktlintCheck

# 2. detekt (é™çš„è§£æ)
echo "ğŸ” Running static analysis (detekt)..."
$GRADLE_CMD detekt

# 3. ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
echo "ğŸ§ª Running tests..."
$GRADLE_CMD test

# 4. ã‚«ãƒãƒ¬ãƒƒã‚¸ãƒã‚§ãƒƒã‚¯ (Phase 1å®Œäº†å¾Œã«æœ‰åŠ¹åŒ–)
# echo "ğŸ“Š Checking test coverage..."
# $GRADLE_CMD jacocoTestCoverageVerification

echo "âœ… All pre-commit checks passed!"
